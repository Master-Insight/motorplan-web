---
import { formatCurrency } from "@/lib/format-curryency"

const adjudicados = [
  { nombre: 'Juan Pérez', localidad: 'Buenos Aires', numeroCuota: 24, montoAdjudicado: 500000, year: 2023, month: 'Enero' },
  { nombre: 'María González', localidad: 'Córdoba', numeroCuota: 36, montoAdjudicado: 750000, year: 2023, month: 'Marzo' },
  { nombre: 'Carlos Rodríguez', localidad: 'Rosario', numeroCuota: 48, montoAdjudicado: 1000000, year: 2024, month: 'Mayo' },
  { nombre: 'Ana Martínez', localidad: 'Mendoza', numeroCuota: 60, montoAdjudicado: 1250000, year: 2022, month: 'Julio' },
  { nombre: 'Lucía Fernández', localidad: 'Salta', numeroCuota: 18, montoAdjudicado: 400000, year: 2024, month: 'Febrero' },
  { nombre: 'Martín Sánchez', localidad: 'Tucumán', numeroCuota: 30, montoAdjudicado: 600000, year: 2021, month: 'Abril' },
  { nombre: 'Laura Ramírez', localidad: 'La Plata', numeroCuota: 42, montoAdjudicado: 900000, year: 2020, month: 'Agosto' },
  { nombre: 'Pedro Gómez', localidad: 'Mar del Plata', numeroCuota: 15, montoAdjudicado: 350000, year: 2023, month: 'Septiembre' },
  { nombre: 'Sofía López', localidad: 'Buenos Aires', numeroCuota: 27, montoAdjudicado: 550000, year: 2022, month: 'Noviembre' },
  { nombre: 'Javier Torres', localidad: 'Rosario', numeroCuota: 39, montoAdjudicado: 850000, year: 2021, month: 'Diciembre' },
  { nombre: 'Clara Rivas', localidad: 'Córdoba', numeroCuota: 21, montoAdjudicado: 450000, year: 2020, month: 'Junio' },
  { nombre: 'Diego Navarro', localidad: 'Mendoza', numeroCuota: 33, montoAdjudicado: 700000, year: 2024, month: 'Octubre' },
  { nombre: 'Elena Ruiz', localidad: 'Salta', numeroCuota: 45, montoAdjudicado: 950000, year: 2023, month: 'Febrero' },
  { nombre: 'Manuel Herrera', localidad: 'Tucumán', numeroCuota: 12, montoAdjudicado: 300000, year: 2021, month: 'Mayo' }
];

const MONTHS = ["none", "Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"]

const year = Number(Astro.url.searchParams.get("year")) || null
const month = Number(Astro.url.searchParams.get("month")) || null
const monthText = month ? MONTHS[month] : ""

// Función que llamará a API en un futuro.
function fetching(year, month) {
  return adjudicados.filter(adj => {
    const matchYear = year ? adj.year === year : true
    const matchMonth = month ? adj.month === MONTHS[month] : true
    return matchYear && matchMonth
  })
}

const listed = year !== null ? fetching(year, month) : adjudicados
---

<section class="py-4">
  <h2 class="text-2xl font-semibold text-center mt-2">
    {`Lista de Adjudicados ${year ? `- ${monthText} ${year}`: ''}`}
  </h2>
  <table class="min-w-full table-auto border-collapse mt-4">
    <thead>
      <tr class="bg-secondary-darker text-white">
        <th class="text-left p-2">Nombre</th>
        <th class="text-left p-2">Localidad</th>
        <th class="text-left p-2">Monto</th>
        <th class="text-left p-2">Cuota</th>
      </tr>
    </thead>  
    <tbody>
      {listed.map((item, i) => (
        <tr class={`${i % 2 === 0 ? 'bg-gray-50' : 'bg-gray-200'}` }>
          <td class="p-2">{item.nombre}</td>
          <td class="p-2">{item.localidad}</td>
          <td class="p-2">{formatCurrency(item.montoAdjudicado)}</td>
          <td class="p-2">{item.numeroCuota}</td>
        </tr>
      ))}
    </tbody>
  </table>
</section>